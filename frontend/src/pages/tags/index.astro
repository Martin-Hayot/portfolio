---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");
const tagCounts = allPosts.reduce((acc: Record<string, number>, post: any) => {
    post.data.tags.forEach((tag: string) => {
        acc[tag] = (acc[tag] || 0) + 1;
    });
    return acc;
}, {});
const tags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
const pageTitle = "Tags";
---

<BaseLayout pageTitle={pageTitle}>
    <main class="max-w-2xl mx-auto">
        <header class="mb-12">
            <a
                href="/blog"
                class="inline-flex items-center gap-2 text-neutral-500 hover:text-neutral-300 transition-colors mb-8 text-sm"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Back to blog
            </a>
            <h1 class="text-3xl font-semibold text-neutral-100 mb-3">Tags</h1>
            <p class="text-neutral-400 text-base">Browse posts by topic</p>
        </header>

        <div class="flex flex-wrap gap-3">
            {
                tags.map(([tag, count]) => (
                    <a
                        href={`/tags/${tag}`}
                        class="inline-flex items-center gap-2 px-4 py-2 border border-neutral-800 rounded-lg text-neutral-400 hover:text-neutral-100 hover:border-neutral-600 transition-colors"
                    >
                        <span>{tag}</span>
                        <span class="text-neutral-600 text-sm">{count}</span>
                    </a>
                ))
            }
        </div>
    </main>
</BaseLayout>
