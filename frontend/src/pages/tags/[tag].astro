---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import BlogList from "@/components/blog/BlogList";

export async function getStaticPaths() {
    const allPosts = await getCollection("blog");
    const uniqueTags = [
        ...new Set(allPosts.map((post) => post.data.tags).flat()),
    ];

    return uniqueTags.map((tag) => {
        const filteredPosts = allPosts
            .filter((post) => post.data.tags.includes(tag))
            .sort(
                (a, b) =>
                    new Date(b.data.pubDate).valueOf() -
                    new Date(a.data.pubDate).valueOf(),
            );
        return {
            params: { tag },
            props: { posts: filteredPosts },
        };
    });
}

const tag = Astro.params.tag as string;
const { posts } = Astro.props;
---

<BaseLayout pageTitle={tag}>
    <main class="max-w-2xl mx-auto">
        <header class="mb-12">
            <a
                href="/tags"
                class="inline-flex items-center gap-2 text-neutral-500 hover:text-neutral-300 transition-colors mb-8 text-sm"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                All tags
            </a>
            <h1 class="text-3xl font-semibold text-neutral-100 mb-3">
                #{tag}
            </h1>
            <p class="text-neutral-400 text-base">
                {posts.length}
                {posts.length === 1 ? "post" : "posts"}
            </p>
        </header>

        <BlogList posts={posts} client:only="react" />
    </main>
</BaseLayout>
